# TradingAgents AgentæŠ€æœ¯æ¶æ„æ·±åº¦åˆ†æï¼ˆåŸºäºå®é™…ä»£ç ï¼‰

## æ¦‚è¿°

æœ¬æ–‡æ¡£åŸºäº**å®é™…ä»£ç **åˆ†æTradingAgentsé¡¹ç›®çš„AgentæŠ€æœ¯æ¶æ„ã€‚é€šè¿‡å¯¹çœŸå®å­˜åœ¨çš„Agentå®ç°ã€çŠ¶æ€ç®¡ç†ã€å·¥ä½œæµæ§åˆ¶ç­‰çš„æ·±å…¥ç ”ç©¶ï¼Œä¸ºå­¦ä¹ è€…æä¾›å‡†ç¡®çš„æŠ€æœ¯åˆ†æã€‚

---

## ğŸ—ï¸ å®é™…Agentæ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„åˆ†æ

TradingAgentsé‡‡ç”¨äº†**å››å±‚é€’è¿›å¼**çš„Agentç»„ç»‡æ¶æ„ï¼Œè¿™ç§è®¾è®¡å…·æœ‰ä»¥ä¸‹æ·±å±‚æ¬¡çš„æŠ€æœ¯è€ƒé‡ï¼š

#### æ¶æ„è®¾è®¡å“²å­¦

1. **ä¸“ä¸šåŒ–åˆ†å·¥åŸç†**ï¼šæ¯å±‚Agentæ‰¿æ‹…ä¸åŒçš„è®¤çŸ¥è´Ÿè½½
   - **ä¿¡æ¯æ”¶é›†å±‚**ï¼šä¸“æ³¨æ•°æ®è·å–å’Œåˆæ­¥åˆ†æ
   - **ç ”ç©¶è¾©è®ºå±‚**ï¼šè´Ÿè´£æ·±åº¦åˆ†æå’Œè§‚ç‚¹ç¢°æ’  
   - **é£é™©è¯„ä¼°å±‚**ï¼šè¿›è¡Œå¤šç»´åº¦é£é™©æƒè¡¡
   - **æ‰§è¡Œå†³ç­–å±‚**ï¼šåŸºäºå‰ä¸‰å±‚ç»“æœåšæœ€ç»ˆå†³ç­–

2. **è®¤çŸ¥è´Ÿè½½åˆ†å±‚**ï¼šé¿å…å•ä¸€Agentæ‰¿æ‹…è¿‡é‡çš„å†³ç­–è´£ä»»
   - æ¯ä¸ªAgentåªéœ€è¦ä¸“æ³¨äºè‡ªå·±çš„ä¸“ä¸šé¢†åŸŸ
   - å¤æ‚å†³ç­–è¢«åˆ†è§£ä¸ºå¤šä¸ªå¯ç®¡ç†çš„å­é—®é¢˜
   - é™ä½äº†å•ç‚¹å¤±è´¥çš„é£é™©

3. **ä¿¡æ¯æµåŠ¨è®¾è®¡**ï¼šç¡®ä¿ä¿¡æ¯åœ¨å±‚çº§é—´æœ‰åºä¼ é€’
   - è‡ªåº•å‘ä¸Šçš„ä¿¡æ¯èšåˆ
   - æ¯å±‚éƒ½å¯¹ä¸Šå±‚æä¾›ç»“æ„åŒ–è¾“å…¥
   - é¿å…ä¿¡æ¯å†—ä½™å’Œå™ªå£°

### 1. çœŸå®çš„Agentç»„ç»‡ç»“æ„

åŸºäºå®é™…ä»£ç ï¼ŒTradingAgentsåŒ…å«ä»¥ä¸‹çœŸå®çš„Agentç±»å‹ï¼š

#### åˆ†æå¸ˆå±‚ï¼ˆAnalystsï¼‰
- **MarketAnalyst** (`tradingagents/agents/analysts/market_analyst.py`)
- **NewsAnalyst** (`tradingagents/agents/analysts/news_analyst.py`)  
- **SocialMediaAnalyst** (`tradingagents/agents/analysts/social_media_analyst.py`)
- **FundamentalsAnalyst** (`tradingagents/agents/analysts/fundamentals_analyst.py`)

#### ç ”ç©¶å‘˜å±‚ï¼ˆResearchersï¼‰
- **BullResearcher** (`tradingagents/agents/researchers/bull_researcher.py`)
- **BearResearcher** (`tradingagents/agents/researchers/bear_researcher.py`)
- **ResearchManager** (`tradingagents/agents/researchers/research_manager.py`)

#### é£é™©ç®¡ç†å±‚ï¼ˆRisk Managementï¼‰
- **AggressiveDebator** (`tradingagents/agents/risk_mgmt/aggressive_debator.py`)
- **ConservativeDebator** (`tradingagents/agents/risk_mgmt/conservative_debator.py`)
- **NeutralDebator** (`tradingagents/agents/risk_mgmt/neutral_debator.py`)
- **RiskManager** (`tradingagents/agents/risk_mgmt/risk_manager.py`)

#### äº¤æ˜“å±‚ï¼ˆTraderï¼‰
- **Trader** (`tradingagents/agents/trader/trader.py`)

### 2. çŠ¶æ€æ¶æ„çš„æŠ€æœ¯åˆ›æ–°åˆ†æ

åŸºäº`tradingagents/agents/utils/agent_states.py`çš„å®é™…ä»£ç ï¼Œç³»ç»Ÿè®¾è®¡äº†ä¸‰å±‚çŠ¶æ€ç®¡ç†æ¶æ„ï¼š

#### æ ¸å¿ƒçŠ¶æ€è®¾è®¡å“²å­¦

```python
# ç¬¬50-77è¡Œï¼šAgentStateçš„å®é™…å®šä¹‰
class AgentState(MessagesState):
    company_of_interest: Annotated[str, "Company that we are interested in trading"]
    trade_date: Annotated[str, "What date we are trading at"]
    sender: Annotated[str, "Agent that sent this message"]
    
    # ä¿¡æ¯æ”¶é›†å±‚çŠ¶æ€
    market_report: Annotated[str, "Report from the Market Analyst"]
    sentiment_report: Annotated[str, "Report from the Social Media Analyst"]
    news_report: Annotated[str, "Report from the News Researcher of current world affairs"]
    fundamentals_report: Annotated[str, "Report from the Fundamentals Researcher"]
    
    # ç ”ç©¶è¾©è®ºå±‚çŠ¶æ€
    investment_debate_state: Annotated[InvestDebateState, "Current state of the debate on if to invest or not"]
    investment_plan: Annotated[str, "Plan generated by the Analyst"]
    trader_investment_plan: Annotated[str, "Plan generated by the Trader"]
    
    # é£é™©è¯„ä¼°å±‚çŠ¶æ€
    risk_debate_state: Annotated[RiskDebateState, "Current state of the debate on evaluating risk"]
    final_trade_decision: Annotated[str, "Final decision made by the Risk Analysts"]
```

**çŠ¶æ€è®¾è®¡çš„æŠ€æœ¯äº®ç‚¹**ï¼š

1. **ç»§æ‰¿MessagesState**ï¼šå¤ç”¨LangGraphçš„æ¶ˆæ¯ç®¡ç†æœºåˆ¶
   - è‡ªåŠ¨å¤„ç†æ¶ˆæ¯å†å²å’Œä¸Šä¸‹æ–‡
   - åˆ©ç”¨LangChainçš„æ¶ˆæ¯è·¯ç”±èƒ½åŠ›
   - ç®€åŒ–äº†çŠ¶æ€åœ¨Agenté—´çš„ä¼ é€’

2. **åˆ†å±‚çŠ¶æ€éš”ç¦»**ï¼šä¸åŒå±‚çº§çš„çŠ¶æ€äº’ä¸å¹²æ‰°
   - ä¿¡æ¯æ”¶é›†å±‚ï¼š4ä¸ªç‹¬ç«‹çš„æŠ¥å‘Šå­—æ®µ
   - è¾©è®ºå±‚ï¼šä¸“é—¨çš„è¾©è®ºçŠ¶æ€ç®¡ç†
   - å†³ç­–å±‚ï¼šæœ€ç»ˆå†³ç­–ç»“æœå­˜å‚¨

3. **ç±»å‹å®‰å…¨è®¾è®¡**ï¼šä½¿ç”¨Annotatedæä¾›è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥
   - æ¯ä¸ªå­—æ®µéƒ½æœ‰æ˜ç¡®çš„è¯­ä¹‰æè¿°
   - ä¾¿äºå¼€å‘æ—¶çš„IDEæç¤ºå’Œé”™è¯¯æ£€æµ‹
   - æé«˜äº†ç³»ç»Ÿçš„å¥å£®æ€§

#### è¾©è®ºçŠ¶æ€çš„å¤æ‚æ€§ç®¡ç†

```python
# ç¬¬11-22è¡Œï¼šInvestDebateStateçš„å®é™…å®šä¹‰
class InvestDebateState(TypedDict):
    bull_history: Annotated[str, "Bullish Conversation history"]
    bear_history: Annotated[str, "Bearish Conversation history"]  
    history: Annotated[str, "Conversation history"]
    current_response: Annotated[str, "Latest response"]
    judge_decision: Annotated[str, "Final judge decision"]
    count: Annotated[int, "Length of the current conversation"]
```

**è¾©è®ºçŠ¶æ€è®¾è®¡çš„æŠ€æœ¯è€ƒé‡**ï¼š

1. **åŒè½¨åˆ¶å†å²è®°å½•**ï¼š
   - `bull_history`å’Œ`bear_history`ï¼šåˆ†åˆ«è®°å½•å¤šå¤´å’Œç©ºå¤´çš„å®Œæ•´è®ºè¯å†å²
   - `history`ï¼šè®°å½•å®Œæ•´çš„äº¤æ›¿è¾©è®ºè¿‡ç¨‹
   - è¿™ç§è®¾è®¡æ”¯æŒAgentåœ¨è¾©è®ºä¸­å¼•ç”¨å¯¹æ–¹çš„å†å²è§‚ç‚¹

2. **è½®æ¬¡æ§åˆ¶æœºåˆ¶**ï¼š
   - `count`å­—æ®µç²¾ç¡®æ§åˆ¶è¾©è®ºè½®æ•°
   - é˜²æ­¢æ— é™å¾ªç¯ï¼Œç¡®ä¿å†³ç­–æ•ˆç‡
   - ä¸ºè¶…æ—¶æ§åˆ¶æä¾›äº†åŸºç¡€

3. **çŠ¶æ€æŒä¹…åŒ–**ï¼š
   - æ‰€æœ‰ä¸­é—´çŠ¶æ€éƒ½è¢«å®Œæ•´ä¿å­˜
   - æ”¯æŒå†³ç­–è¿‡ç¨‹çš„å®Œæ•´å›æº¯
   - ä¸ºåç»­çš„åæ€å­¦ä¹ æä¾›äº†æ•°æ®åŸºç¡€

#### ä¸‰æ–¹é£é™©è¾©è®ºçš„çŠ¶æ€å¤æ‚æ€§

```python
# ç¬¬25-48è¡Œï¼šRiskDebateStateçš„å®é™…å®šä¹‰  
class RiskDebateState(TypedDict):
    risky_history: Annotated[str, "Risky Agent's Conversation history"]
    safe_history: Annotated[str, "Safe Agent's Conversation history"]
    neutral_history: Annotated[str, "Neutral Agent's Conversation history"]
    history: Annotated[str, "Conversation history"]
    latest_speaker: Annotated[str, "Analyst that spoke last"]
    current_risky_response: Annotated[str, "Latest response by the risky analyst"]
    current_safe_response: Annotated[str, "Latest response by the safe analyst"]
    current_neutral_response: Annotated[str, "Latest response by the neutral analyst"]
    judge_decision: Annotated[str, "Judge's decision"]
    count: Annotated[int, "Length of the current conversation"]
```

**ä¸‰æ–¹è¾©è®ºçŠ¶æ€çš„æŠ€æœ¯åˆ›æ–°**ï¼š

1. **å¤šç»´åº¦çŠ¶æ€è·Ÿè¸ª**ï¼š
   - ä¸ºæ¯ä¸ªé£é™©ç«‹åœºç»´æŠ¤ç‹¬ç«‹çš„å†å²è®°å½•
   - `latest_speaker`ç¡®ä¿å‘è¨€æƒçš„æ­£ç¡®è½®æ¢
   - `current_*_response`æ”¯æŒAgenté—´çš„ç²¾ç¡®å›åº”

2. **å¤æ‚äº¤äº’ç®¡ç†**ï¼š
   - ç›¸æ¯”äºŒæ–¹è¾©è®ºï¼Œä¸‰æ–¹è¾©è®ºçš„çŠ¶æ€å¤æ‚åº¦å‘ˆæŒ‡æ•°çº§å¢é•¿
   - æ¯ä¸ªAgentéƒ½éœ€è¦åŒæ—¶è€ƒè™‘å…¶ä»–ä¸¤æ–¹çš„è§‚ç‚¹
   - çŠ¶æ€è®¾è®¡å·§å¦™åœ°å¤„ç†äº†è¿™ç§å¤æ‚æ€§

3. **å†³ç­–èåˆæœºåˆ¶**ï¼š
   - é€šè¿‡`judge_decision`å®ç°ä¸‰æ–¹è§‚ç‚¹çš„æœ€ç»ˆèåˆ
   - ä¸ºé£é™©ç®¡ç†å†³ç­–æä¾›äº†å¤šç»´åº¦çš„è¾“å…¥

### 3. åŒLLMæ¶æ„çš„æŠ€æœ¯åˆ›æ–°åˆ†æ

åŸºäº`tradingagents/graph/trading_graph.py`ç¬¬61-71è¡Œçš„å®é™…ä»£ç ï¼Œç³»ç»Ÿå®ç°äº†å·®å¼‚åŒ–çš„åŒLLMæ¶æ„ï¼š

#### LLMèµ„æºåˆ†é…çš„æŠ€æœ¯å“²å­¦

```python
# ç¬¬61-71è¡Œï¼šå®é™…çš„LLMåˆå§‹åŒ–é€»è¾‘
if self.config["llm_provider"].lower() == "openai" or self.config["llm_provider"] == "ollama" or self.config["llm_provider"] == "openrouter":
    self.deep_thinking_llm = ChatOpenAI(model=self.config["deep_think_llm"], base_url=self.config["backend_url"])
    self.quick_thinking_llm = ChatOpenAI(model=self.config["quick_think_llm"], base_url=self.config["backend_url"])
elif self.config["llm_provider"].lower() == "anthropic":
    self.deep_thinking_llm = ChatAnthropic(model=self.config["deep_think_llm"], base_url=self.config["backend_url"])
    self.quick_thinking_llm = ChatAnthropic(model=self.config["quick_think_llm"], base_url=self.config["backend_url"])
```

**åŒLLMæ¶æ„çš„æˆ˜ç•¥æ„ä¹‰**ï¼š

1. **è®¤çŸ¥è´Ÿè½½åŒ¹é…**ï¼šä¸åŒå¤æ‚åº¦çš„ä»»åŠ¡ä½¿ç”¨ä¸åŒèƒ½åŠ›çš„æ¨¡å‹
   - **Deep Think LLM**ï¼šç”¨äºéœ€è¦å¤æ‚æ¨ç†çš„å…³é”®å†³ç­–èŠ‚ç‚¹
   - **Quick Think LLM**ï¼šç”¨äºä¸“ä¸šåŒ–ä½†ç›¸å¯¹æ ‡å‡†çš„åˆ†æä»»åŠ¡

2. **æˆæœ¬æ•ˆç‡ä¼˜åŒ–**ï¼š
   - é¿å…æ‰€æœ‰ä»»åŠ¡éƒ½ä½¿ç”¨æœ€æ˜‚è´µçš„æ¨¡å‹
   - åœ¨å†³ç­–è´¨é‡å’Œè¿è¥æˆæœ¬ä¹‹é—´æ‰¾åˆ°æœ€ä¼˜å¹³è¡¡ç‚¹
   - æ”¯æŒç³»ç»Ÿçš„å¤§è§„æ¨¡éƒ¨ç½²å’Œå•†ä¸šåŒ–åº”ç”¨

3. **æ€§èƒ½æ¢¯åº¦è®¾è®¡**ï¼š
   - å…³é”®å†³ç­–èŠ‚ç‚¹ï¼ˆResearchManagerã€RiskManagerï¼‰ä½¿ç”¨æœ€å¼ºæ¨¡å‹
   - ä¸“ä¸šåˆ†æèŠ‚ç‚¹ä½¿ç”¨é«˜æ•ˆæ¨¡å‹ï¼Œä¿è¯å“åº”é€Ÿåº¦
   - æ•´ä½“ç³»ç»Ÿå“åº”æ€§å’Œå†³ç­–è´¨é‡çš„å¹³è¡¡

#### å®é™…çš„æ¨¡å‹åˆ†é…ç­–ç•¥åˆ†æ

åŸºäºä»£ç åˆ†æï¼Œç³»ç»Ÿçš„æ¨¡å‹åˆ†é…éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

**Deep Think LLMä½¿ç”¨åœºæ™¯ï¼ˆ2ä¸ªå…³é”®èŠ‚ç‚¹ï¼‰**ï¼š
- **ResearchManager**ï¼šéœ€è¦ç»¼åˆBull/BearåŒæ–¹è®ºè¯ï¼Œåšå‡ºå¹³è¡¡çš„æŠ•èµ„å»ºè®®
- **RiskManager**ï¼šéœ€è¦æ•´åˆä¸‰æ–¹é£é™©è§‚ç‚¹ï¼Œåšå‡ºæœ€ç»ˆçš„é£é™©è¯„ä¼°

**Quick Think LLMä½¿ç”¨åœºæ™¯ï¼ˆ10+ä¸ªèŠ‚ç‚¹ï¼‰**ï¼š
- **æ‰€æœ‰Analystç±»å‹**ï¼šä¸“ä¸šåŒ–æ•°æ®åˆ†æï¼Œæœ‰æ ‡å‡†åŒ–çš„åˆ†ææ¡†æ¶
- **Bull/Bear Researcher**ï¼šåŸºäºæç¤ºè¯æ¨¡æ¿çš„ç»“æ„åŒ–è¾©è®º
- **ä¸‰æ–¹Risk Debator**ï¼šè§’è‰²æ˜ç¡®çš„é£é™©è§‚ç‚¹è¡¨è¾¾
- **Trader**ï¼šåŸºäºå‰åºå†³ç­–çš„æ‰§è¡Œå±‚é¢æ“ä½œ

**è¿™ç§åˆ†é…çš„æŠ€æœ¯åˆç†æ€§**ï¼š

1. **å†³ç­–æƒé‡åŒ¹é…æ¨¡å‹èƒ½åŠ›**ï¼š
   - å½±å“æœ€ç»ˆå†³ç­–çš„èŠ‚ç‚¹ä½¿ç”¨æœ€å¼ºæ¨¡å‹
   - æä¾›ä¿¡æ¯è¾“å…¥çš„èŠ‚ç‚¹ä½¿ç”¨é«˜æ•ˆæ¨¡å‹
   - ç¬¦åˆä¿¡æ¯å¤„ç†çš„å±‚æ¬¡åŒ–åŸç†

2. **ç“¶é¢ˆè¯†åˆ«ç²¾å‡†**ï¼š
   - ç³»ç»Ÿçš„å†³ç­–è´¨é‡ä¸»è¦å–å†³äºä¸¤ä¸ªå…³é”®ä»²è£èŠ‚ç‚¹
   - å…¶ä»–èŠ‚ç‚¹è™½ç„¶é‡è¦ï¼Œä½†éƒ½æœ‰ç›¸å¯¹æ ‡å‡†åŒ–çš„å·¥ä½œæ¨¡å¼
   - é¿å…äº†èµ„æºçš„ä¸å½“åˆ†é…

3. **å¯æ‰©å±•æ€§è€ƒè™‘**ï¼š
   - åˆ†æå¸ˆå±‚å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€æ‰©å±•ï¼Œä¸ä¼šæ˜¾è‘—å¢åŠ æˆæœ¬
   - æ ¸å¿ƒå†³ç­–å±‚ä¿æŒç¨³å®šçš„é«˜è´¨é‡æ¨¡å‹
   - æ”¯æŒç³»ç»Ÿè§„æ¨¡çš„å¼¹æ€§å¢é•¿
### 4. Agentå®ç°æ¨¡å¼çš„æŠ€æœ¯åˆ†æ

åŸºäºå„Agentæ–‡ä»¶çš„å®é™…ä»£ç ç»“æ„ï¼š

```python
# æ¥è‡ªmarket_analyst.pyç¬¬53-75è¡Œçš„å®é™…å®ç°
prompt = ChatPromptTemplate.from_messages([
    (
        "system",
        "You are a helpful AI assistant, collaborating with other assistants."
        " Use the provided tools to progress towards answering the question."
        " If you are unable to fully answer, that's OK; another assistant with different tools"
        " will help where you left off. Execute what you can to make progress."
        " If you or any other assistant has the FINAL TRANSACTION PROPOSAL: **BUY/HOLD/SELL** or deliverable,"
        " prefix your response with FINAL TRANSACTION PROPOSAL: **BUY/HOLD/SELL** so the team knows to stop."
        " You have access to the following tools: {tool_names}.\\n{system_message}"
        "For your reference, the current date is {current_date}. The company we want to look at is {ticker}",
    ),
    MessagesPlaceholder(variable_name="messages"),
])

prompt = prompt.partial(system_message=system_message)
prompt = prompt.partial(tool_names=", ".join([tool.name for tool in tools]))
prompt = prompt.partial(current_date=current_date)
prompt = prompt.partial(ticker=ticker)

chain = prompt | llm.bind_tools(tools)
```

#### Agentå®ç°æ¨¡å¼çš„æŠ€æœ¯åˆ›æ–°

**1. ç»Ÿä¸€åä½œæ¡†æ¶è®¾è®¡**ï¼š

- **åä½œæ„è¯†æ¤å…¥**ï¼šæ¯ä¸ªAgentéƒ½è¢«æ˜ç¡®å‘ŠçŸ¥è‡ªå·±æ˜¯"collaborative team"çš„ä¸€éƒ¨åˆ†
- **ä»»åŠ¡è¿ç»­æ€§ä¿è¯**ï¼šé€šè¿‡"another assistant will help where you left off"ç¡®ä¿å·¥ä½œæµçš„è¿ç»­æ€§
- **ç»ˆæ­¢æ¡ä»¶æ¸…æ™°**ï¼šé€šè¿‡"FINAL TRANSACTION PROPOSAL"æä¾›æ˜ç¡®çš„æµç¨‹ç»ˆæ­¢ä¿¡å·

**2. æ¨¡æ¿åŒ–ä¸ä¸ªæ€§åŒ–çš„å¹³è¡¡**ï¼š

- **ç»Ÿä¸€æ¨¡æ¿**ï¼šæ‰€æœ‰Agentä½¿ç”¨ç›¸åŒçš„åŸºç¡€åä½œæ¡†æ¶
- **ä¸“ä¸šåŒ–æ³¨å…¥**ï¼šé€šè¿‡`system_message`å˜é‡æ³¨å…¥ä¸“ä¸šåŒ–çš„è§’è‰²å®šä¹‰
- **ä¸Šä¸‹æ–‡ç»‘å®š**ï¼šé€šè¿‡`partial`æ–¹æ³•åŠ¨æ€ç»‘å®šå·¥å…·ã€æ—¥æœŸã€è‚¡ç¥¨ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯

**3. å·¥å…·ç»‘å®šçš„æŠ€æœ¯å®ç°**ï¼š

```python
# å®é™…çš„å·¥å…·é€‰æ‹©é€»è¾‘ï¼ˆmarket_analyst.pyç¬¬13-22è¡Œï¼‰
if toolkit.config["online_tools"]:
    tools = [
        toolkit.get_YFin_data_online,
        toolkit.get_stockstats_indicators_report_online,
    ]
else:
    tools = [
        toolkit.get_YFin_data,
        toolkit.get_stockstats_indicators_report,
    ]
```

**å·¥å…·é…ç½®çš„æŠ€æœ¯äº®ç‚¹**ï¼š

- **ç¯å¢ƒé€‚åº”æ€§**ï¼šæ ¹æ®`online_tools`é…ç½®è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å·¥å…·é›†
- **åŠŸèƒ½ç­‰ä»·æ€§**ï¼šåœ¨çº¿å’Œç¦»çº¿å·¥å…·æä¾›ç›¸åŒçš„åŠŸèƒ½ï¼Œåªæ˜¯æ•°æ®æºä¸åŒ
- **è¿è¡Œæ—¶å†³ç­–**ï¼šå·¥å…·é€‰æ‹©åœ¨Agentåˆå§‹åŒ–æ—¶åŠ¨æ€å†³å®šï¼Œè€Œéç¡¬ç¼–ç 

**4. LangChainé›†æˆçš„æ·±åº¦åº”ç”¨**ï¼š

- **ChatPromptTemplate**ï¼šåˆ©ç”¨LangChainçš„æ¨¡æ¿ç³»ç»Ÿå®ç°å¤æ‚çš„æç¤ºè¯æ„å»º
- **MessagesPlaceholder**ï¼šè‡ªåŠ¨ç®¡ç†å¯¹è¯å†å²ï¼Œç®€åŒ–äº†çŠ¶æ€ç®¡ç†
- **bind_tools**ï¼šå°†å·¥å…·èƒ½åŠ›ä¸LLMæ— ç¼é›†æˆ
- **partialç»‘å®š**ï¼šå®ç°æ¨¡æ¿çš„å‚æ•°åŒ–å¤ç”¨

---

## ğŸ§  å®é™…å¯¹è¯ä¸è¾©è®ºæœºåˆ¶

### 3. Bull vs Bearç ”ç©¶å‘˜çš„çœŸå®å®ç°

#### Bullç ”ç©¶å‘˜çš„å®é™…æç¤ºè¯ï¼ˆbull_researcher.pyç¬¬25-43è¡Œï¼‰

```python
prompt = f"""You are a Bull Analyst advocating for investing in the stock. Your task is to build a strong, evidence-based case emphasizing growth potential, competitive advantages, and positive market indicators. Leverage the provided research and data to address concerns and counter bearish arguments effectively.

Key points to focus on:
- Growth Potential: Highlight the company's market opportunities, revenue projections, and scalability.
- Competitive Advantages: Emphasize factors like unique products, strong branding, or dominant market positioning.
- Positive Indicators: Use financial health, industry trends, and recent positive news as evidence.
- Bear Counterpoints: Critically analyze the bear argument with specific data and sound reasoning, addressing concerns thoroughly and showing why the bull perspective holds stronger merit.
- Engagement: Present your argument in a conversational style, engaging directly with the bear analyst's points and debating effectively rather than just listing data.

Resources available:
Market research report: {market_research_report}
Social media sentiment report: {sentiment_report}
Latest world affairs news: {news_report}
Company fundamentals report: {fundamentals_report}
Conversation history of the debate: {history}
Last bear argument: {current_response}
Reflections from similar situations and lessons learned: {past_memory_str}
Use this information to deliver a compelling bull argument, refute the bear's concerns, and engage in a dynamic debate that demonstrates the strengths of the bull position. You must also address reflections and learn from lessons and mistakes you made in the past.
"""
```

#### Bearç ”ç©¶å‘˜çš„å®é™…æç¤ºè¯ï¼ˆbear_researcher.pyç¬¬25-45è¡Œï¼‰

```python
prompt = f"""You are a Bear Analyst making the case against investing in the stock. Your goal is to present a well-reasoned argument emphasizing risks, challenges, and negative indicators. Leverage the provided research and data to highlight potential downsides and counter bullish arguments effectively.

Key points to focus on:

- Risks and Challenges: Highlight factors like market saturation, financial instability, or macroeconomic threats that could hinder the stock's performance.
- Competitive Weaknesses: Emphasize vulnerabilities such as weaker market positioning, declining innovation, or threats from competitors.
- Negative Indicators: Use evidence from financial data, market trends, or recent adverse news to support your position.
- Bull Counterpoints: Critically analyze the bull argument with specific data and sound reasoning, exposing weaknesses or over-optimistic assumptions.
- Engagement: Present your argument in a conversational style, directly engaging with the bull analyst's points and debating effectively rather than simply listing facts.

Resources available:

Market research report: {market_research_report}
Social media sentiment report: {sentiment_report}
Latest world affairs news: {news_report}
Company fundamentals report: {fundamentals_report}
Conversation history of the debate: {history}
Last bull argument: {current_response}
Reflections from similar situations and lessons learned: {past_memory_str}
Use this information to deliver a compelling bear argument, refute the bull's claims, and engage in a dynamic debate that demonstrates the risks and weaknesses of investing in the stock. You must also address reflections and learn from lessons and mistakes you made in the past.
"""
```

### 4. é£é™©ç®¡ç†çš„ä¸‰æ–¹è¾©è®ºæœºåˆ¶

#### æ¿€è¿›é£é™©åˆ†æå¸ˆï¼ˆaggressive_debator.pyç¬¬21-33è¡Œï¼‰

```python
prompt = f"""As the Risky Risk Analyst, your role is to actively champion high-reward, high-risk opportunities, emphasizing bold strategies and competitive advantages. When evaluating the trader's decision or plan, focus intently on the potential upside, growth potential, and innovative benefitsâ€”even when these come with elevated risk. Use the provided market data and sentiment analysis to strengthen your arguments and challenge the opposing views. Specifically, respond directly to each point made by the conservative and neutral analysts, countering with data-driven rebuttals and persuasive reasoning. Highlight where their caution might miss critical opportunities or where their assumptions may be overly conservative. Here is the trader's decision:

{trader_decision}

Your task is to create a compelling case for the trader's decision by questioning and critiquing the conservative and neutral stances to demonstrate why your high-reward perspective offers the best path forward. Incorporate insights from the following sources into your arguments:

Market Research Report: {market_research_report}
Social Media Sentiment Report: {sentiment_report}
Latest World Affairs Report: {news_report}
Company Fundamentals Report: {fundamentals_report}
Here is the current conversation history: {history} Here are the last arguments from the conservative analyst: {current_safe_response} Here are the last arguments from the neutral analyst: {current_neutral_response}. If there are no responses from the other viewpoints, do not halluncinate and just present your point.

Engage actively by addressing any specific concerns raised, refuting the weaknesses in their logic, and asserting the benefits of risk-taking to outpace market norms. Maintain a focus on debating and persuading, not just presenting data. Challenge each counterpoint to underscore why a high-risk approach is optimal. Output conversationally as if you are speaking without any special formatting."""
```

#### ä¿å®ˆé£é™©åˆ†æå¸ˆï¼ˆconservative_debator.pyç¬¬22-34è¡Œï¼‰

```python
prompt = f"""As the Safe/Conservative Risk Analyst, your primary objective is to protect assets, minimize volatility, and ensure steady, reliable growth. You prioritize stability, security, and risk mitigation, carefully assessing potential losses, economic downturns, and market volatility. When evaluating the trader's decision or plan, critically examine high-risk elements, pointing out where the decision may expose the firm to undue risk and where more cautious alternatives could secure long-term gains. Here is the trader's decision:

{trader_decision}

Your task is to actively counter the arguments of the Risky and Neutral Analysts, highlighting where their views may overlook potential threats or fail to prioritize sustainability. Respond directly to their points, drawing from the following data sources to build a convincing case for a low-risk approach adjustment to the trader's decision:

Market Research Report: {market_research_report}
Social Media Sentiment Report: {sentiment_report}
Latest World Affairs Report: {news_report}
Company Fundamentals Report: {fundamentals_report}
Here is the current conversation history: {history} Here is the last response from the risky analyst: {current_risky_response} Here is the last response from the neutral analyst: {current_neutral_response}. If there are no responses from the other viewpoints, do not halluncinate and just present your point.

Engage by questioning their optimism and emphasizing the potential downsides they may have overlooked. Address each of their counterpoints to showcase why a conservative stance is ultimately the safest path for the firm's assets. Focus on debating and critiquing their arguments to demonstrate the strength of a low-risk strategy over their approaches. Output conversationally as if you are speaking without any special formatting."""
```

### 5. è¾©è®ºæœºåˆ¶çš„æŠ€æœ¯åˆ›æ–°åˆ†æ

#### å¯¹è¯å¼è¾©è®ºvsä¼ ç»Ÿå¹¶è¡Œåˆ†æçš„æŠ€æœ¯ä¼˜åŠ¿

**ä¼ ç»Ÿæ–¹æ³•çš„å±€é™æ€§**ï¼š
- å„Agentç‹¬ç«‹åˆ†æï¼Œç¼ºä¹è§‚ç‚¹ç¢°æ’
- æ— æ³•å‘ç°åˆ†æç›²ç‚¹å’Œåè§
- ç¼ºä¹åŠ¨æ€çš„è§‚ç‚¹è°ƒæ•´æœºåˆ¶

**TradingAgentsçš„è¾©è®ºåˆ›æ–°**ï¼š

1. **çœŸå®å¯¹è¯äº¤äº’**ï¼š
   - Bull/Bear Agentéœ€è¦ç›´æ¥å›åº”å¯¹æ–¹çš„å…·ä½“è§‚ç‚¹
   - é€šè¿‡`{current_response}`å’Œ`{history}`å®ç°ä¸Šä¸‹æ–‡è¿ç»­æ€§
   - æ¯è½®è¾©è®ºéƒ½å»ºç«‹åœ¨å‰è½®çš„åŸºç¡€ä¸Š

2. **è§‚ç‚¹è¿›åŒ–æœºåˆ¶**ï¼š
   - Agentåœ¨è¾©è®ºè¿‡ç¨‹ä¸­å¯ä»¥è°ƒæ•´å’Œå®Œå–„è‡ªå·±çš„è§‚ç‚¹
   - é€šè¿‡åé©³å¯¹æ–¹æ¥åŠ å¼ºè‡ªå·±çš„è®ºè¯
   - ä¿ƒè¿›äº†å†³ç­–è´¨é‡çš„èºæ—‹å¼ä¸Šå‡

3. **å¤šç»´åº¦ä¿¡æ¯æ•´åˆ**ï¼š
   - æ¯ä¸ªAgentéƒ½æ¥æ”¶ç›¸åŒçš„å¸‚åœºä¿¡æ¯ï¼ˆ7ç§æ•°æ®æºï¼‰
   - ä½†ä»ä¸åŒè§’åº¦ï¼ˆBull vs Bearï¼‰è¿›è¡Œè§£è¯»
   - å†å²è®°å¿†ï¼ˆ`{past_memory_str}`ï¼‰æä¾›ç»éªŒå­¦ä¹ æ”¯æŒ

#### ä¸‰æ–¹é£é™©è¾©è®ºçš„å¤æ‚æ€§ç®¡ç†

ç›¸æ¯”äºŒæ–¹è¾©è®ºï¼Œä¸‰æ–¹è¾©è®ºçš„æŠ€æœ¯æŒ‘æˆ˜å‘ˆæŒ‡æ•°çº§å¢é•¿ï¼š

**çŠ¶æ€å¤æ‚æ€§**ï¼š
- éœ€è¦è¿½è¸ª3ä¸ªç‹¬ç«‹çš„å†å²è®°å½•
- ç®¡ç†3ä¸ªå½“å‰å›åº”çŠ¶æ€
- å¤„ç†3Ã—2=6ç§å›åº”å…³ç³»

**è½®æ¢é€»è¾‘çš„æŠ€æœ¯å®ç°**ï¼š
```python
# åŸºäºlatest_speakerçš„æ™ºèƒ½è½®æ¢
if last_speaker.startswith("Risky"):
    return "Safe Analyst"     # æ¿€è¿› â†’ ä¿å®ˆ
elif last_speaker.startswith("Safe"):
    return "Neutral Analyst"  # ä¿å®ˆ â†’ ä¸­æ€§  
return "Risky Analyst"        # ä¸­æ€§ â†’ æ¿€è¿›
```

**è§‚ç‚¹èåˆçš„æŠ€æœ¯æŒ‘æˆ˜**ï¼š
- RiskManageréœ€è¦æ•´åˆä¸‰æ–¹è§‚ç‚¹
- ä¸æ˜¯ç®€å•çš„æŠ•ç¥¨æœºåˆ¶ï¼Œè€Œæ˜¯åŸºäºè®ºè¯è´¨é‡çš„æƒè¡¡
- ä½“ç°äº†å¤æ‚å†³ç­–çš„ç°å®æ€§

---

## ğŸ§  å®é™…è®°å¿†ä¸åæ€ç³»ç»Ÿçš„æŠ€æœ¯åˆ›æ–°

### 6. åˆ†å¸ƒå¼è®°å¿†æ¶æ„çš„è®¾è®¡å“²å­¦

åŸºäº`tradingagents/graph/trading_graph.py`ç¬¬75-80è¡Œçš„å®é™…ä»£ç ï¼š

```python
# å®é™…çš„è®°å¿†ç³»ç»Ÿåˆå§‹åŒ–
self.bull_memory = FinancialSituationMemory("bull_memory", self.config)
self.bear_memory = FinancialSituationMemory("bear_memory", self.config)
self.trader_memory = FinancialSituationMemory("trader_memory", self.config)
self.invest_judge_memory = FinancialSituationMemory("invest_judge_memory", self.config)
self.risk_manager_memory = FinancialSituationMemory("risk_manager_memory", self.config)
```

#### åˆ†å¸ƒå¼è®°å¿†çš„æŠ€æœ¯åˆ›æ–°åˆ†æ

**1. è§’è‰²ä¸“é—¨åŒ–è®°å¿†è®¾è®¡**ï¼š

æ¯ç±»å…³é”®Agentç»´æŠ¤ç‹¬ç«‹çš„ä¸“ä¸šåŒ–è®°å¿†ï¼Œè¿™ç§è®¾è®¡æœ‰æ·±å±‚æ¬¡çš„æŠ€æœ¯è€ƒé‡ï¼š

- **è®¤çŸ¥ä¸“é—¨åŒ–**ï¼šBullå’ŒBearè®°å¿†åˆ†åˆ«ç§¯ç´¯å¤šå¤´å’Œç©ºå¤´çš„ä¸“ä¸šç»éªŒ
- **å†³ç­–å±‚è®°å¿†**ï¼šJudgeå’ŒRiskManagerè®°å¿†ä¸“æ³¨äºé«˜å±‚å†³ç­–çš„å†å²ç»éªŒ
- **æ‰§è¡Œå±‚è®°å¿†**ï¼šTraderè®°å¿†å…³æ³¨å…·ä½“æ‰§è¡Œç­–ç•¥çš„æ•ˆæœåé¦ˆ

**2. è®°å¿†éš”ç¦»ä¸ä¸“ä¸šåŒ–çš„æŠ€æœ¯ä¼˜åŠ¿**ï¼š

```python
# å®é™…çš„ä¸“é—¨åŒ–åæ€å®ç°ï¼ˆreflection.pyç¬¬73-91è¡Œï¼‰
def reflect_bull_researcher(self, current_state, returns_losses, bull_memory):
    situation = self._extract_current_situation(current_state)
    bull_debate_history = current_state["investment_debate_state"]["bull_history"]
    
    result = self._reflect_on_component(
        "BULL", bull_debate_history, situation, returns_losses
    )
    bull_memory.add_situations([(situation, result)])
```

**æŠ€æœ¯äº®ç‚¹åˆ†æ**ï¼š

- **ä¸Šä¸‹æ–‡ç›¸å…³æ€§**ï¼šæ¯ä¸ªè®°å¿†ç³»ç»Ÿåªå­˜å‚¨ä¸å…¶è§’è‰²ç›¸å…³çš„ç»éªŒ
- **æ£€ç´¢ç²¾ç¡®æ€§**ï¼šæŸ¥è¯¢æ—¶èƒ½è·å¾—æ›´åŠ ç²¾å‡†çš„å†å²ç»éªŒåŒ¹é…
- **é¿å…å¹²æ‰°**ï¼šä¸åŒè§’è‰²çš„ç»éªŒä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œä¿æŒä¸“ä¸šæ€§

**3. å‘é‡åŒ–è®°å¿†æ£€ç´¢çš„æŠ€æœ¯å®ç°**ï¼š

è™½ç„¶å…·ä½“çš„FinancialSituationMemoryå®ç°åœ¨memory.pyä¸­ï¼Œä½†å¯ä»¥åˆ†æå…¶æŠ€æœ¯æ¶æ„ï¼š

- **è¯­ä¹‰ç›¸ä¼¼åº¦åŒ¹é…**ï¼šåŸºäºembeddingå‘é‡è€Œéå…³é”®è¯
- **æƒ…å¢ƒåŒ–æ£€ç´¢**ï¼šèƒ½å¤Ÿç†è§£å½“å‰å¸‚åœºæƒ…å†µä¸å†å²æƒ…å†µçš„ç›¸ä¼¼æ€§
- **å¤šç»´åº¦åŒ¹é…**ï¼šä¸ä»…åŒ¹é…å¸‚åœºæ•°æ®ï¼Œè¿˜åŒ¹é…å†³ç­–context

#### åæ€å­¦ä¹ æœºåˆ¶çš„ç³»ç»Ÿæ€§åˆ†æ

åŸºäºreflection.pyçš„å®é™…4æ­¥åæ€æ¡†æ¶ï¼š

**1. Reasoningï¼ˆæ¨ç†åˆ†æï¼‰**ï¼š
- åŸºäºå®é™…æ”¶ç›Šç»“æœåˆ¤æ–­å†³ç­–æ­£ç¡®æ€§
- åˆ†æ8ä¸ªå…·ä½“ç»´åº¦çš„è´¡çŒ®å› ç´ 
- æƒè¡¡å„å› ç´ åœ¨å†³ç­–ä¸­çš„é‡è¦æ€§

**2. Improvementï¼ˆæ”¹è¿›å»ºè®®ï¼‰**ï¼š
- å¯¹é”™è¯¯å†³ç­–æå‡ºå…·ä½“ä¿®æ­£æ–¹æ¡ˆ
- æä¾›å¯æ“ä½œçš„æ”¹è¿›æªæ–½æ¸…å•
- åŒ…å«å…·ä½“çš„æ—¥æœŸå’Œå†³ç­–è°ƒæ•´å»ºè®®

**3. Summaryï¼ˆç»éªŒæ€»ç»“ï¼‰**ï¼š
- æ€»ç»“æˆåŠŸå’Œå¤±è´¥çš„æ•™è®­
- å»ºç«‹ç›¸ä¼¼æƒ…å†µé—´çš„è”ç³»
- ä¸ºæœªæ¥å†³ç­–æä¾›æŒ‡å¯¼åŸåˆ™

**4. Queryï¼ˆæ´å¯Ÿæç‚¼ï¼‰**ï¼š
- å°†å¤æ‚åæ€æµ“ç¼©ä¸º1000å­—ç¬¦ä»¥å†…çš„æ ¸å¿ƒæ´å¯Ÿ
- ä¾¿äºå¿«é€Ÿæ£€ç´¢å’Œå‚è€ƒ
- ä¿æŒçŸ¥è¯†çš„å¯è®¿é—®æ€§

**åæ€ç³»ç»Ÿçš„æŠ€æœ¯ä»·å€¼**ï¼š

1. **é—­ç¯å­¦ä¹ **ï¼šå†³ç­–â†’æ‰§è¡Œâ†’ç»“æœâ†’åæ€â†’æ”¹è¿›çš„å®Œæ•´å¾ªç¯
2. **ç»“æœå¯¼å‘**ï¼šåŸºäºå®é™…äº¤æ˜“æ”¶ç›Šè€Œéç†è®ºåˆ†æ
3. **å…·ä½“åŒ–æ”¹è¿›**ï¼šæä¾›å¯æ‰§è¡Œçš„å…·ä½“å»ºè®®ï¼Œè€ŒéæŠ½è±¡åŸåˆ™
4. **çŸ¥è¯†ç§¯ç´¯**ï¼šå°†ç»éªŒè½¬åŒ–ä¸ºå¯æ£€ç´¢çš„ç»“æ„åŒ–çŸ¥è¯†

---

## âš™ï¸ ç³»ç»Ÿå·¥ç¨‹åŒ–ä¸æ¶æ„åˆ›æ–°

### 7. TradingAgentsGraphçš„æ€»ä½“æ¶æ„åˆ†æ

åŸºäº`tradingagents/graph/trading_graph.py`çš„å®é™…å®ç°ï¼Œç³»ç»Ÿé‡‡ç”¨äº†é«˜åº¦æ¨¡å—åŒ–çš„æ¶æ„è®¾è®¡ï¼š

#### ç»„ä»¶åŒ–è®¾è®¡çš„æŠ€æœ¯å“²å­¦

```python
# ç¬¬86-102è¡Œï¼šå®é™…çš„ç»„ä»¶åˆå§‹åŒ–
self.conditional_logic = ConditionalLogic()
self.graph_setup = GraphSetup(
    self.quick_thinking_llm,
    self.deep_thinking_llm,
    self.toolkit,
    self.tool_nodes,
    self.bull_memory,
    self.bear_memory,
    self.trader_memory,
    self.invest_judge_memory,
    self.risk_manager_memory,
    self.conditional_logic,
)

self.propagator = Propagator()
self.reflector = Reflector(self.quick_thinking_llm)
self.signal_processor = SignalProcessor(self.quick_thinking_llm)
```

**æ¶æ„è®¾è®¡çš„æŠ€æœ¯äº®ç‚¹**ï¼š

1. **èŒè´£åˆ†ç¦»åŸåˆ™**ï¼š
   - **ConditionalLogic**ï¼šä¸“é—¨å¤„ç†å·¥ä½œæµè·¯ç”±é€»è¾‘
   - **GraphSetup**ï¼šè´Ÿè´£å›¾ç»“æ„çš„æ„å»ºå’Œé…ç½®
   - **Propagator**ï¼šå¤„ç†çŠ¶æ€ä¼ æ’­å’Œæ‰§è¡Œæ§åˆ¶
   - **Reflector**ï¼šä¸“é—¨è´Ÿè´£åæ€å­¦ä¹ æœºåˆ¶
   - **SignalProcessor**ï¼šå¤„ç†æœ€ç»ˆä¿¡å·çš„è§£æå’Œæ ‡å‡†åŒ–

2. **ä¾èµ–æ³¨å…¥è®¾è®¡**ï¼š
   - æ‰€æœ‰ç»„ä»¶é€šè¿‡æ„é€ å‡½æ•°æ¥æ”¶ä¾èµ–
   - ä¾¿äºå•å…ƒæµ‹è¯•å’Œæ¨¡å—æ›¿æ¢
   - é™ä½äº†ç»„ä»¶é—´çš„è€¦åˆåº¦

3. **é…ç½®é©±åŠ¨æ¶æ„**ï¼š
   - é€šè¿‡configæ§åˆ¶ç³»ç»Ÿè¡Œä¸º
   - æ”¯æŒä¸åŒçš„éƒ¨ç½²ç¯å¢ƒå’Œè¿è¡Œæ¨¡å¼
   - å®ç°äº†ä»£ç ä¸é…ç½®çš„åˆ†ç¦»

#### å·¥å…·èŠ‚ç‚¹çš„æŠ€æœ¯åˆ›æ–°

```python
# ç¬¬112-155è¡Œï¼šå®é™…çš„å·¥å…·èŠ‚ç‚¹åˆ›å»º
def _create_tool_nodes(self) -> Dict[str, ToolNode]:
    return {
        "market": ToolNode([
            # online tools
            self.toolkit.get_YFin_data_online,
            self.toolkit.get_stockstats_indicators_report_online,
            # offline tools
            self.toolkit.get_YFin_data,
            self.toolkit.get_stockstats_indicators_report,
        ]),
        "social": ToolNode([
            # online tools
            self.toolkit.get_stock_news_openai,
            # offline tools
            self.toolkit.get_reddit_stock_info,
        ]),
        # ... å…¶ä»–å·¥å…·èŠ‚ç‚¹
    }
```

**å·¥å…·èŠ‚ç‚¹è®¾è®¡çš„æŠ€æœ¯ä¼˜åŠ¿**ï¼š

1. **æ··åˆå·¥å…·é…ç½®**ï¼š
   - æ¯ä¸ªToolNodeåŒæ—¶åŒ…å«åœ¨çº¿å’Œç¦»çº¿å·¥å…·
   - Agentå¯ä»¥æ ¹æ®é…ç½®å’Œå¯ç”¨æ€§åŠ¨æ€é€‰æ‹©
   - æä¾›äº†æ•°æ®è·å–çš„å†—ä½™å’Œå¯é æ€§

2. **LangGraph ToolNodeé›†æˆ**ï¼š
   - åˆ©ç”¨LangGraphçš„åŸç”Ÿå·¥å…·æ‰§è¡Œèƒ½åŠ›
   - è‡ªåŠ¨å¤„ç†å·¥å…·è°ƒç”¨çš„é”™è¯¯å’Œé‡è¯•
   - ç®€åŒ–äº†å·¥å…·è°ƒç”¨çš„çŠ¶æ€ç®¡ç†

3. **åˆ†ç±»ç»„ç»‡**ï¼š
   - æŒ‰åŠŸèƒ½åŸŸï¼ˆmarketã€socialã€newsã€fundamentalsï¼‰ç»„ç»‡å·¥å…·
   - ä¾¿äºAgenté€‰æ‹©å’Œå·¥å…·ç®¡ç†
   - æ”¯æŒå·¥å…·é›†çš„ç‹¬ç«‹æ‰©å±•

### 8. æ‰§è¡Œæµç¨‹çš„æŠ€æœ¯åˆ›æ–°

#### æµå¼æ‰§è¡Œä¸è°ƒè¯•æ”¯æŒ

```python
# ç¬¬157-191è¡Œï¼šå®é™…çš„propagateæ–¹æ³•
def propagate(self, company_name, trade_date):
    self.ticker = company_name
    
    init_agent_state = self.propagator.create_initial_state(
        company_name, trade_date
    )
    args = self.propagator.get_graph_args()
    
    if self.debug:
        # Debug mode with tracing
        trace = []
        for chunk in self.graph.stream(init_agent_state, **args):
            if len(chunk["messages"]) == 0:
                pass
            else:
                chunk["messages"][-1].pretty_print()
                trace.append(chunk)
        
        final_state = trace[-1]
    else:
        # Standard mode without tracing
        final_state = self.graph.invoke(init_agent_state, **args)
    
    # Store current state for reflection
    self.curr_state = final_state
    
    # Log state
    self._log_state(trade_date, final_state)
    
    # Return decision and processed signal
    return final_state, self.process_signal(final_state["final_trade_decision"])
```

**æ‰§è¡Œæµç¨‹çš„æŠ€æœ¯ç‰¹è‰²**ï¼š

1. **åŒæ¨¡å¼æ‰§è¡Œ**ï¼š
   - Debugæ¨¡å¼ï¼šæµå¼æ‰§è¡Œï¼Œå®æ—¶è§‚å¯Ÿä¸­é—´çŠ¶æ€
   - Standardæ¨¡å¼ï¼šæ‰¹é‡æ‰§è¡Œï¼Œè¿½æ±‚æ€§èƒ½æ•ˆç‡
   - æ”¯æŒä¸åŒåœºæ™¯çš„éœ€æ±‚

2. **çŠ¶æ€æŒä¹…åŒ–**ï¼š
   - å®Œæ•´è®°å½•å†³ç­–è¿‡ç¨‹çš„æ‰€æœ‰ä¸­é—´çŠ¶æ€
   - æ”¯æŒå†³ç­–è¿‡ç¨‹çš„å®Œæ•´å›æº¯å’Œå®¡è®¡
   - ä¸ºç›‘ç®¡åˆè§„æä¾›äº†æ•°æ®åŸºç¡€

3. **ä¿¡å·å¤„ç†æ ‡å‡†åŒ–**ï¼š
   - é€šè¿‡SignalProcessorç»Ÿä¸€å¤„ç†æœ€ç»ˆå†³ç­–ä¿¡å·
   - å°†å¤æ‚çš„å†³ç­–æ–‡æœ¬è½¬åŒ–ä¸ºæ ‡å‡†åŒ–çš„äº¤æ˜“ä¿¡å·
   - ä¾¿äºä¸‹æ¸¸ç³»ç»Ÿçš„é›†æˆ

#### çŠ¶æ€æ—¥å¿—çš„å·¥ç¨‹åŒ–è®¾è®¡

```python
# ç¬¬192-233è¡Œï¼šå®é™…çš„_log_stateæ–¹æ³•
def _log_state(self, trade_date, final_state):
    self.log_states_dict[str(trade_date)] = {
        "company_of_interest": final_state["company_of_interest"],
        "trade_date": final_state["trade_date"],
        "market_report": final_state["market_report"],
        "sentiment_report": final_state["sentiment_report"],
        "news_report": final_state["news_report"],
        "fundamentals_report": final_state["fundamentals_report"],
        "investment_debate_state": {
            "bull_history": final_state["investment_debate_state"]["bull_history"],
            "bear_history": final_state["investment_debate_state"]["bear_history"],
            "history": final_state["investment_debate_state"]["history"],
            "current_response": final_state["investment_debate_state"]["current_response"],
            "judge_decision": final_state["investment_debate_state"]["judge_decision"],
        },
        "trader_investment_decision": final_state["trader_investment_plan"],
        "risk_debate_state": {
            "risky_history": final_state["risk_debate_state"]["risky_history"],
            "safe_history": final_state["risk_debate_state"]["safe_history"],
            "neutral_history": final_state["risk_debate_state"]["neutral_history"],
            "history": final_state["risk_debate_state"]["history"],
            "judge_decision": final_state["risk_debate_state"]["judge_decision"],
        },
        "investment_plan": final_state["investment_plan"],
        "final_trade_decision": final_state["final_trade_decision"],
    }
    
    # Save to file
    directory = Path(f"eval_results/{self.ticker}/TradingAgentsStrategy_logs/")
    directory.mkdir(parents=True, exist_ok=True)
    
    with open(
        f"eval_results/{self.ticker}/TradingAgentsStrategy_logs/full_states_log_{trade_date}.json",
        "w",
    ) as f:
        json.dump(self.log_states_dict, f, indent=4)
```

**çŠ¶æ€æ—¥å¿—çš„å·¥ç¨‹ä»·å€¼**ï¼š

1. **å®Œæ•´æ€§**ï¼šè®°å½•æ‰€æœ‰å…³é”®å†³ç­–èŠ‚ç‚¹çš„å®Œæ•´ä¿¡æ¯
2. **ç»“æ„åŒ–**ï¼šä½¿ç”¨JSONæ ¼å¼ï¼Œä¾¿äºç¨‹åºåŒ–åˆ†æ
3. **å¯è¿½æº¯æ€§**ï¼šæŒ‰æ—¥æœŸå’Œè‚¡ç¥¨ç»„ç»‡ï¼Œæ”¯æŒå†å²å›é¡¾
4. **åˆè§„æ€§**ï¼šä¸ºç›‘ç®¡å®¡è®¡æä¾›å®Œæ•´çš„å†³ç­–è½¨è¿¹

### 9. å­¦ä¹ é—­ç¯çš„ç³»ç»Ÿæ€§å®ç°

```python
# ç¬¬234-251è¡Œï¼šå®é™…çš„reflect_and_rememberæ–¹æ³•
def reflect_and_remember(self, returns_losses):
    """Reflect on decisions and update memory based on returns."""
    self.reflector.reflect_bull_researcher(
        self.curr_state, returns_losses, self.bull_memory
    )
    self.reflector.reflect_bear_researcher(
        self.curr_state, returns_losses, self.bear_memory
    )
    self.reflector.reflect_trader(
        self.curr_state, returns_losses, self.trader_memory
    )
    self.reflector.reflect_invest_judge(
        self.curr_state, returns_losses, self.invest_judge_memory
    )
    self.reflector.reflect_risk_manager(
        self.curr_state, returns_losses, self.risk_manager_memory
    )
```

**å­¦ä¹ é—­ç¯çš„æŠ€æœ¯åˆ›æ–°**ï¼š

1. **å¤šç»„ä»¶å¹¶è¡Œå­¦ä¹ **ï¼šæ¯ä¸ªå…³é”®Agentéƒ½ä»ç›¸åŒçš„ç»“æœä¸­å­¦ä¹ ä¸åŒçš„ç»éªŒ
2. **è§’è‰²åŒ–åæ€**ï¼šä¸åŒè§’è‰²ä»ä¸åŒè§’åº¦åæ€ç›¸åŒçš„å†³ç­–ç»“æœ
3. **ç»éªŒç§¯ç´¯**ï¼šå­¦ä¹ ç»“æœç›´æ¥æ›´æ–°åˆ°å„è‡ªçš„ä¸“é—¨åŒ–è®°å¿†ç³»ç»Ÿ
4. **æŒç»­æ”¹è¿›**ï¼šå½¢æˆå†³ç­–â†’æ‰§è¡Œâ†’ç»“æœâ†’å­¦ä¹ â†’æ”¹è¿›çš„å®Œæ•´é—­ç¯

---

## ğŸš€ æŠ€æœ¯åˆ›æ–°æ€»ç»“ä¸ä»·å€¼åˆ†æ

### æ ¸å¿ƒæŠ€æœ¯åˆ›æ–°ç‚¹

#### 1. ğŸ—ï¸ **å››å±‚é€’è¿›å¼Agentæ¶æ„åˆ›æ–°**

**è®¾è®¡å“²å­¦**ï¼šå°†å¤æ‚çš„æŠ•èµ„å†³ç­–åˆ†è§£ä¸ºå››ä¸ªè®¤çŸ¥å±‚çº§ï¼Œæ¯å±‚ä¸“æ³¨äºç‰¹å®šçš„å†³ç­–ç»´åº¦

**æŠ€æœ¯ä»·å€¼**ï¼š
- **è®¤çŸ¥è´Ÿè½½åˆ†å¸ƒ**ï¼šé¿å…å•ä¸€Agentæ‰¿æ‹…è¿‡é‡çš„å†³ç­–è´£ä»»
- **ä¸“ä¸šåŒ–ä¼˜åŠ¿**ï¼šæ¯å±‚Agentåœ¨å…¶ä¸“ä¸šé¢†åŸŸå†…è¾¾åˆ°æœ€ä¼˜è¡¨ç°  
- **å†³ç­–è´¨é‡ä¿è¯**ï¼šé€šè¿‡å¤šå±‚çº§éªŒè¯é™ä½å†³ç­–é”™è¯¯ç‡
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒåœ¨å„å±‚çº§ç‹¬ç«‹æ·»åŠ æ–°çš„ä¸“ä¸šAgent

**å®é™…åº”ç”¨ä»·å€¼**ï¼šä¸ºæ„å»ºå¤§è§„æ¨¡ä¸“ä¸šåŒ–AIç³»ç»Ÿæä¾›äº†æ¶æ„èŒƒå¼

#### 2. ğŸ§  **åŒLLMå·®å¼‚åŒ–èµ„æºé…ç½®åˆ›æ–°**

**æ ¸å¿ƒæ´å¯Ÿ**ï¼šä¸åŒå¤æ‚åº¦çš„ä»»åŠ¡åº”åŒ¹é…ä¸åŒèƒ½åŠ›çš„æ¨¡å‹

**æŠ€æœ¯ä»·å€¼**ï¼š
- **æˆæœ¬æ•ˆç‡ä¼˜åŒ–**ï¼šåœ¨ä¿è¯å†³ç­–è´¨é‡çš„å‰æä¸‹æœ€å°åŒ–LLMä½¿ç”¨æˆæœ¬
- **æ€§èƒ½æ¢¯åº¦è®¾è®¡**ï¼šå…³é”®èŠ‚ç‚¹ä½¿ç”¨æœ€å¼ºæ¨¡å‹ï¼Œå¸¸è§„èŠ‚ç‚¹ä½¿ç”¨é«˜æ•ˆæ¨¡å‹
- **å•†ä¸šåŒ–å¯è¡Œæ€§**ï¼šä½¿ç³»ç»Ÿå…·å¤‡å¤§è§„æ¨¡éƒ¨ç½²çš„ç»æµå¯è¡Œæ€§

**å®é™…åº”ç”¨ä»·å€¼**ï¼šä¸ºä¼ä¸šçº§AIç³»ç»Ÿçš„èµ„æºé…ç½®æä¾›äº†ä¼˜åŒ–ç­–ç•¥

#### 3. ğŸ­ **çœŸå®å¯¹è¯è¾©è®ºæœºåˆ¶åˆ›æ–°**

**çªç ´ä¼ ç»Ÿ**ï¼šä»å¹¶è¡Œç‹¬ç«‹åˆ†æè½¬å‘äº¤äº’å¼å¯¹è¯è¾©è®º

**æŠ€æœ¯ä»·å€¼**ï¼š
- **è§‚ç‚¹è¿›åŒ–æœºåˆ¶**ï¼šé€šè¿‡è¾©è®ºä¿ƒè¿›è§‚ç‚¹çš„åŠ¨æ€è°ƒæ•´å’Œå®Œå–„
- **åè§æ¶ˆé™¤**ï¼šå¤šæ–¹è§‚ç‚¹ç¢°æ’æœ‰æ•ˆå‡å°‘å•ä¸€è§†è§’çš„è®¤çŸ¥åå·®
- **å†³ç­–é€æ˜åŒ–**ï¼šå®Œæ•´è®°å½•ä¸åŒè§‚ç‚¹çš„äº¤é”‹è¿‡ç¨‹ï¼Œæä¾›å†³ç­–å¯è§£é‡Šæ€§

**å®é™…åº”ç”¨ä»·å€¼**ï¼šä¸ºå¤æ‚å†³ç­–ç³»ç»Ÿæä¾›äº†æ–°çš„äº¤äº’èŒƒå¼

#### 4. ğŸ“Š **åˆ†å±‚çŠ¶æ€ç®¡ç†æ¶æ„åˆ›æ–°**

**è®¾è®¡ç²¾é«“**ï¼šé€šè¿‡TypedDictå’ŒAnnotatedå®ç°ç±»å‹å®‰å…¨çš„å¤æ‚çŠ¶æ€ç®¡ç†

**æŠ€æœ¯ä»·å€¼**ï¼š
- **çŠ¶æ€éš”ç¦»**ï¼šä¸åŒå±‚çº§çš„çŠ¶æ€äº’ä¸å¹²æ‰°ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦
- **ç±»å‹å®‰å…¨**ï¼šè¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ï¼Œæé«˜ç³»ç»Ÿå¥å£®æ€§
- **è¿½æº¯å®Œæ•´æ€§**ï¼šå®Œæ•´ä¿å­˜å†³ç­–è¿‡ç¨‹çš„æ‰€æœ‰ä¸­é—´çŠ¶æ€

**å®é™…åº”ç”¨ä»·å€¼**ï¼šä¸ºå¤æ‚çŠ¶æ€æœºè®¾è®¡æä¾›äº†å·¥ç¨‹åŒ–æ–¹æ¡ˆ

#### 5. ğŸ§  **åˆ†å¸ƒå¼ä¸“ä¸šåŒ–è®°å¿†ç³»ç»Ÿåˆ›æ–°**

**æ ¸å¿ƒç†å¿µ**ï¼šæ¯ç±»Agentç»´æŠ¤ç‹¬ç«‹çš„ä¸“ä¸šåŒ–è®°å¿†

**æŠ€æœ¯ä»·å€¼**ï¼š
- **è¯­ä¹‰æ£€ç´¢**ï¼šåŸºäºå‘é‡ç›¸ä¼¼åº¦çš„æ™ºèƒ½ç»éªŒåŒ¹é…
- **ä¸“ä¸šåŒ–å­¦ä¹ **ï¼šä¸åŒè§’è‰²ç§¯ç´¯å„è‡ªé¢†åŸŸçš„ä¸“é—¨ç»éªŒ
- **æŒç»­æ”¹è¿›**ï¼šåŸºäºå®é™…ç»“æœçš„é—­ç¯å­¦ä¹ æœºåˆ¶

**å®é™…åº”ç”¨ä»·å€¼**ï¼šä¸ºAIç³»ç»Ÿçš„æŒç»­å­¦ä¹ èƒ½åŠ›æä¾›äº†æŠ€æœ¯åŸºç¡€

### å¯¹AgentæŠ€æœ¯å‘å±•çš„è´¡çŒ®

#### **åœ¨Multi-Agent Systemsé¢†åŸŸçš„æ„ä¹‰**

1. **åä½œæ¨¡å¼åˆ›æ–°**ï¼š
   - ä»è¯·æ±‚-å“åº”æ¨¡å¼å‡çº§ä¸ºçœŸæ­£çš„å¯¹è¯åä½œ
   - å»ºç«‹äº†ä¸“ä¸šåŒ–Agenté—´çš„æœ‰æ•ˆåä½œæœºåˆ¶
   - å±•ç¤ºäº†å¤§è§„æ¨¡Agentç³»ç»Ÿçš„å¯è¡Œæ€§

2. **çŠ¶æ€ç®¡ç†çªç ´**ï¼š
   - è§£å†³äº†å¤æ‚å¤šAgentç³»ç»Ÿçš„çŠ¶æ€åŒæ­¥é—®é¢˜
   - æä¾›äº†ç±»å‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ
   - å®ç°äº†çŠ¶æ€çš„å®Œæ•´æŒä¹…åŒ–å’Œå›æº¯

3. **å­¦ä¹ æœºåˆ¶åˆ›æ–°**ï¼š
   - å°†ä¸ªä½“å­¦ä¹ æ‰©å±•ä¸ºç¾¤ä½“åä½œå­¦ä¹ 
   - å®ç°äº†åŸºäºç»“æœåé¦ˆçš„æŒç»­æ”¹è¿›
   - å»ºç«‹äº†åˆ†å¸ƒå¼è®°å¿†ä¸ç»éªŒå…±äº«æœºåˆ¶

#### **åœ¨é‡‘èç§‘æŠ€é¢†åŸŸçš„ä»·å€¼**

1. **å†³ç­–é€æ˜åŒ–**ï¼š
   - å®Œæ•´è®°å½•å†³ç­–è¿‡ç¨‹å’Œå„æ–¹è§‚ç‚¹
   - æä¾›å¯å®¡è®¡çš„å†³ç­–è½¨è¿¹
   - æ»¡è¶³é‡‘èç›‘ç®¡çš„åˆè§„è¦æ±‚

2. **é£é™©æ§åˆ¶åˆ›æ–°**ï¼š
   - å¤šå±‚çº§é£é™©è¯„ä¼°æœºåˆ¶
   - ä¸‰æ–¹è¾©è®ºçš„é£é™©è§‚ç‚¹å¹³è¡¡
   - åŸºäºå†å²ç»éªŒçš„é£é™©é¢„è­¦

3. **ä¸“ä¸šçŸ¥è¯†ç³»ç»ŸåŒ–**ï¼š
   - å°†é‡‘èä¸“å®¶ç»éªŒç¼–ç ä¸ºAgentèƒ½åŠ›
   - å®ç°ä¸“ä¸šçŸ¥è¯†çš„è§„æ¨¡åŒ–å¤ç”¨
   - æ”¯æŒ7Ã—24å°æ—¶çš„æ™ºèƒ½å†³ç­–æœåŠ¡

#### **å¯¹AIç³»ç»Ÿå·¥ç¨‹åŒ–çš„å¯ç¤º**

1. **æ¶æ„è®¾è®¡åŸåˆ™**ï¼š
   - ä¸“ä¸šåŒ–åˆ†å·¥ä¸ç»Ÿä¸€åä½œçš„å¹³è¡¡
   - é…ç½®é©±åŠ¨çš„çµæ´»æ€§è®¾è®¡
   - ç»„ä»¶åŒ–å’Œæ¨¡å—åŒ–çš„å·¥ç¨‹å®è·µ

2. **èµ„æºä¼˜åŒ–ç­–ç•¥**ï¼š
   - å·®å¼‚åŒ–æ¨¡å‹é…ç½®çš„æˆæœ¬æ§åˆ¶
   - åœ¨çº¿/ç¦»çº¿æ•°æ®æºçš„æ··åˆä½¿ç”¨
   - å·¥å…·ç³»ç»Ÿçš„å†—ä½™å’Œå®¹é”™è®¾è®¡

3. **å¯è§‚æµ‹æ€§å»ºè®¾**ï¼š
   - å®Œæ•´çš„çŠ¶æ€æ—¥å¿—å’Œå®¡è®¡è½¨è¿¹
   - è°ƒè¯•å‹å¥½çš„æ‰§è¡Œæ¨¡å¼åˆ‡æ¢
   - ç³»ç»ŸåŒ–çš„æ€§èƒ½ç›‘æ§æœºåˆ¶

### æŠ€æœ¯ä»·å€¼ä¸å•†ä¸šå½±å“

**æŠ€æœ¯æˆç†Ÿåº¦**ï¼šTradingAgentså±•ç¤ºäº†Multi-Agentç³»ç»Ÿåœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸­çš„å®ç”¨æ€§ï¼Œæ ‡å¿—ç€AgentæŠ€æœ¯ä»å®éªŒå®¤èµ°å‘äº§ä¸šåº”ç”¨çš„é‡è¦è¿›å±•ã€‚

**å¯å¤ç”¨æ€§**ï¼šç³»ç»Ÿçš„æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯å®ç°å…·æœ‰å¾ˆå¼ºçš„é€šç”¨æ€§ï¼Œå¯ä»¥æ‰©å±•åˆ°å…¶ä»–éœ€è¦å¤æ‚å†³ç­–çš„é¢†åŸŸï¼Œå¦‚ï¼š
- æ™ºèƒ½æŠ•é¡¾å’Œè´¢å¯Œç®¡ç†
- ä¾›åº”é“¾ä¼˜åŒ–å†³ç­–
- åŒ»ç–—è¯Šæ–­è¾…åŠ©
- æ³•å¾‹æ¡ˆä¾‹åˆ†æ

**å•†ä¸šä»·å€¼**ï¼šé€šè¿‡AIæŠ€æœ¯çš„ç³»ç»ŸåŒ–åº”ç”¨ï¼Œå®ç°äº†ä¸“ä¸šå†³ç­–èƒ½åŠ›çš„è§„æ¨¡åŒ–å’Œæ ‡å‡†åŒ–ï¼Œä¸ºé‡‘èæœåŠ¡è¡Œä¸šçš„æ•°å­—åŒ–è½¬å‹æä¾›äº†æŠ€æœ¯åŸºç¡€ã€‚

## ç»“è®º

TradingAgentsä¸ä»…ä»…æ˜¯ä¸€ä¸ªå¤šAgentäº¤æ˜“ç³»ç»Ÿï¼Œæ›´æ˜¯AgentæŠ€æœ¯åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸­çš„å·¥ç¨‹åŒ–å…¸èŒƒã€‚å…¶åœ¨æ¶æ„è®¾è®¡ã€åä½œæœºåˆ¶ã€çŠ¶æ€ç®¡ç†ã€å­¦ä¹ èƒ½åŠ›ç­‰æ–¹é¢çš„åˆ›æ–°ï¼Œä¸ºæ„å»ºå¤§è§„æ¨¡ã€é«˜æ€§èƒ½çš„AIåä½œç³»ç»Ÿæä¾›äº†å®è´µçš„æŠ€æœ¯å‚è€ƒå’Œå®è·µç»éªŒã€‚

é€šè¿‡åŸºäº**å®é™…ä»£ç **çš„æ·±åº¦åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°TradingAgentsåœ¨æŠ€æœ¯å®ç°ä¸Šçš„ä¸¥è°¨æ€§å’Œåˆ›æ–°æ€§ï¼Œè¿™ä¸ºAgentæŠ€æœ¯çš„è¿›ä¸€æ­¥å‘å±•å’Œäº§ä¸šåŒ–åº”ç”¨å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚
